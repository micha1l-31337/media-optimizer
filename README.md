# Media Optimizer (Windows Batch)

Утилита на базе Windows Batch (CMD), FFmpeg и ImageMagick для автоматизированной оптимизации фото- и видеоархивов. Скрипт предназначен для рекурсивной обработки каталогов с сохранением оригинальной структуры папок и метаданных. Рекурсивно сжимает фото (JPG/HEIC) и видео (H.264/H.265) с сохранением структуры папок. Поддерживает Drag&amp;Drop, CLI и авто-установку FFmpeg/ImageMagick. Поддерживает сжатие, копирование или пропуск выбранных типов файлов, т.е. можно скопировать только фото или только видео одной командой.

Идеально подходит для организации домашнего NAS, бэкапов или хранения медиатеки.

## Основные возможности

* **Экономия места без видимой потери качества:**
    * **Современные смартфоны:** Сжатие фото в 3-5 раз (с перекодированием HEIC в JPG).
    * **Видео:** Уменьшение объема в 2-3 раза (конвертация в H.264/H.265).
    * **Зеркальные камеры (DSLR):** Для старых камер, снимавших с низким сжатием, экономия достигает 10 раз.
* **Полное зеркалирование структуры:** Скрипт воссоздает дерево каталогов источника в целевой папке.
* **Обработка сопутствующих файлов:** При необходимости копирует файлы, не являющиеся медиа (документы, проекты, текстовые заметки и музыку), сохраняя целостность архива.
* **Производительность:**
    * Фото: ~1 секунда на файл.
    * Видео: Скорость кодирования в 2-5 раз выше времени видеоролика (зависит от железа и поддержки NVENC).
* **Автоматизация:** Поддержка Drag & Drop и аргументов командной строки (CLI) для запуска по расписанию.

## Требования

Скрипт использует системные утилиты:
* **FFmpeg** (обработка видео и JPG)
* **ImageMagick** (обработка HEIC и ресайз)

> **Примечание:** При первом запуске скрипт автоматически проверит наличие этих утилит. Если они не найдены, он предложит установить их через `winget` (требуются права администратора).

## Использование

### 1. Drag & Drop (Самый простой способ)
Просто перетащите папку с архивом (или отдельные файлы) на файл скрипта `.bat`.
Откроется меню конфигурации, где можно:
* Выбрать режим для фото/видео (Сжимать / Копировать как есть / Пропускать).
* Настроить целевое разрешение и качество.
* Нажать `ENTER` для старта.

### 2. Командная строка (CLI)
Скрипт можно встраивать в пайплайны или запускать через Планировщик задач. Если переданы аргументы, интерактивное меню пропускается.

**Примеры запуска:**

```cmd
:: Полная обработка архива с сохранением в отдельную папку
media_optimizer.bat -source "D:\Raw_Photos" -dest "Z:\Archive_Optimized" -video_mode 2

:: Только сжатие видео в текущей папке (фото копируются)
media_optimizer.bat -process_photos 0 -process_videos 1 -video_px 1080
